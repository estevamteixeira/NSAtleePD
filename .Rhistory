MZ37201 >= 1 |
MZ37301 >= 1 |
MZ37501 >= 1 |
MZ37611 >= 1 |
MZ37911 >= 1 , 1, 0)),
by = list(BrthYear)] %>%
.[, .(BrthYear,
dlv,
MZ311,
MZ312,
MZ313)] %>%
unique() %>%
arrange(BrthYear)
View(dta1)
dta1 <- dta[, .(BrthYear,
MZ311,
MZ312,
MZ313,
MZ37001,
MZ37101,
MZ37201,
MZ37301,
MZ37501,
MZ37611,
MZ37911
)] %>%
.[, `:=` (dlv  = fifelse(
MZ37001 >= 1 |
MZ37101 >= 1 |
MZ37201 >= 1 |
MZ37301 >= 1 |
MZ37501 >= 1 |
MZ37611 >= 1 |
MZ37911 >= 1 , 1, 0)),
by = list(BrthYear)] %>%
.[, .(BrthYear,
dlv,
MZ311,
MZ312,
MZ313)]
View(dta1)
apply(dta1, 2, sum)
-
dta1 <- dta[, .(BrthYear,
DLNUMFET,
# MZ311,
# MZ312,
# MZ313,
MZ37001,
MZ37101,
MZ37201,
MZ37301,
MZ37501,
MZ37611,
MZ37911
)] %>%
.[, `:=` (art  = fifelse(
MZ37001 >= 1 |
MZ37101 >= 1 |
MZ37201 >= 1 |
MZ37301 >= 1 |
MZ37501 >= 1 |
MZ37611 >= 1 |
MZ37911 >= 1 , 1, 0),
dlv = fifelse( DLNUMFET >= 1, 1, 0)),
by = list(BrthYear)] %>%
.[, .(BrthYear,
dlv,
# MZ311,
# MZ312,
# MZ313,
art)] %>%
# unique() %>%
arrange(BrthYear)
dta1 <- dta[, .(BrthYear,
DLNUMFET,
# MZ311,
# MZ312,
# MZ313,
MZ37001,
MZ37101,
MZ37201,
MZ37301,
MZ37501,
MZ37611,
MZ37911
)] %>%
.[, `:=` (art  = fifelse(
MZ37001 >= 1 |
MZ37101 >= 1 |
MZ37201 >= 1 |
MZ37301 >= 1 |
MZ37501 >= 1 |
MZ37611 >= 1 |
MZ37911 >= 1 , 1, 0),
dlv = fifelse( DLNUMFET >= 1, 1, 0)),
by = list(BrthYear)] %>%
.[, .(BrthYear,
dlv,
# MZ311,
# MZ312,
# MZ313,
art)] %>%
# unique() %>%
arrange(BrthYear)
View(dta1)
apply(dta1, 2, sum)
tabyl(dta1, dlv, BrthYear)
tabyl(dta1, art, BrthYear)
dta1 <- dta[, .(BrthYear,
DLNUMFET,
# MZ311,
# MZ312,
# MZ313,
MZ37001,
MZ37101,
MZ37201,
MZ37301,
MZ37501,
MZ37611,
MZ37911
)] %>%
.[, `:=` (art  = fifelse(
MZ37001 >= 1 |
MZ37101 >= 1 |
MZ37201 >= 1 |
MZ37301 >= 1 |
MZ37501 >= 1 |
MZ37611 >= 1 |
MZ37911 >= 1 , 1, 0),
dlv = fifelse( DLNUMFET >= 1, 1, 0)),
by = list(BrthYear)] %>%
.[, .(BrthYear,
dlv,
# MZ311,
# MZ312,
# MZ313,
art)] %>%
arrange(BrthYear) %>%
.[, `:=` (dlv = sum(dlv, na.rm = TRUE),
art = sum(art, na.rm = TRUE)),
by = list(BrthYear)] %>%
unique()
View(dta1)
dta1 <- dta[, .(BrthYear,
DLNUMFET,
# MZ311,
# MZ312,
# MZ313,
MZ37001,
MZ37101,
MZ37201,
MZ37301,
MZ37501,
MZ37611,
MZ37911
)] %>%
.[, `:=` (art  = fifelse(
MZ37001 >= 1 |
MZ37101 >= 1 |
MZ37201 >= 1 |
MZ37301 >= 1 |
MZ37501 >= 1 |
MZ37611 >= 1 |
MZ37911 >= 1 , 1, 0),
dlv = fifelse( DLNUMFET >= 1, 1, 0)),
by = list(BrthYear)] %>%
.[, .(BrthYear,
dlv,
# MZ311,
# MZ312,
# MZ313,
art)] %>%
arrange(BrthYear) %>%
.[, `:=` (dlv = sum(dlv, na.rm = TRUE),
art = sum(art, na.rm = TRUE)),
by = list(BrthYear)] %>%
.[, `:=` (prop = art/dlv)]
dta1 <- dta[, .(BrthYear,
DLNUMFET,
# MZ311,
# MZ312,
# MZ313,
MZ37001,
MZ37101,
MZ37201,
MZ37301,
MZ37501,
MZ37611,
MZ37911
)] %>%
.[, `:=` (art  = fifelse(
MZ37001 >= 1 |
MZ37101 >= 1 |
MZ37201 >= 1 |
MZ37301 >= 1 |
MZ37501 >= 1 |
MZ37611 >= 1 |
MZ37911 >= 1 , 1, 0),
dlv = fifelse( DLNUMFET >= 1, 1, 0)),
by = list(BrthYear)] %>%
.[, .(BrthYear,
dlv,
# MZ311,
# MZ312,
# MZ313,
art)] %>%
arrange(BrthYear) %>%
.[, `:=` (dlv = sum(dlv, na.rm = TRUE),
art = sum(art, na.rm = TRUE)),
by = list(BrthYear)] %>%
.[, `:=` (prop = art/dlv)] %>%
unique()
View(dta1)
plot <- ggplot(data = dta1,
aes(x = BrthYear,
y = prop,
group = 1,
text = paste("<br>Year:", BrthYear,
"<br># births:", scales::comma(dlv, accuracy = 1),
"<br># ART births:", scales::comma(art, accuracy = 1),
"<br>ART %:", scales::percent(prop, accuracy = 0.1)
)
)
) +
geom_point(color = "#757575",
show.legend = FALSE) +
geom_line(color = "#757575",
show.legend = FALSE,
alpha = 0.65) +
# scale_x_date(date_breaks = "2 years",
#              date_labels = "%Y") +
scale_x_continuous(#trans = 'log2',
breaks = pretty) +
scale_y_continuous(#trans = 'log2',
breaks = pretty,
labels = scales::percent_format(accuracy = 0.1),
limits = c(0, NA)) +
labs(y = 'Number of births', x = '') +
theme_minimal()
plot
tbl <- dta[, .(BrthYear,
BTOUTCOM,
BTSEX)] %>%
.[,`:=` ( dlv = fifelse( !BTOUTCOM %in% "FTD" &
BTSEX %in% "M", "Male live births",
fifelse(!BTOUTCOM %in% "FTD" &
BTSEX %in% "F", "Female live births",
fifelse(BTOUTCOM %in% "FTD" &
BTSEX %in% "M", "Male stillbirths","Female stillbirths"))),
dlv1 = fifelse(!BTOUTCOM %in% "FTD", "Total live births", "Total stillbirths"))] %>%
# remove ambiguous phenotype sex
.[!tolower(BTSEX) %in% "a"] %>%
.[, `:=` (BTSEX = factor(BTSEX,
levels = c("F","M"),
labels = c("Female","Male")))]
tbl.f <- tbl[tolower(BTSEX) %in% "female",] %>%
janitor::tabyl(dlv, BrthYear) %>%
# add column totals
janitor::adorn_totals(c("row"), name = "Female births")
tbl.m <- tbl[tolower(BTSEX) %in% "male",] %>%
janitor::tabyl(dlv, BrthYear) %>%
# add column totals
janitor::adorn_totals(c("row"), name = "Male births")
tbl.t <- tbl %>%
janitor::tabyl(dlv1, BrthYear) %>%
# add column totals
janitor::adorn_totals(c("row"), name = "Total births") %>%
setnames(old = "dlv1", new = "dlv")
tbl <- rbind(tbl.f, tbl.m, tbl.t) %>%
# add titles
janitor::adorn_title(row_name = "",
col_name = "")
knitr::kable(tbl,
format = "html",
booktabs = TRUE) %>%
# add an hline before the total
kableExtra::row_spec(nrow(tbl) - 1, hline_after = TRUE) %>%  kableExtra::row_spec(nrow(tbl), bold = TRUE) %>%
kableExtra::row_spec(0, bold = TRUE) %>%
kableExtra::row_spec(nrow(tbl) - 6, bold = TRUE) %>%
kableExtra::row_spec(nrow(tbl) - 3, bold = TRUE) %>%
kableExtra::column_spec(1, border_right = TRUE, bold  = TRUE) %>%
kableExtra::kable_styling(font_size = 12) %>%
kableExtra::add_footnote(label = c("Sex could not be determined in some infants and these infants are not included in the male or female categories.",
"Note: Stillbirth refers to the complete expulsion or extraction from its mother after at least 20 weeks pregnancy, or after attaining a
weight of 500 g or more, of a fetus in whom, after such expulsion or extraction, there is no breathing, beating of the heart, pulsation
of the umbilical cord, or unmistakable movement of voluntary muscle."))
View(tbl)
frmt_ns <- dta[, .(BrthYear,
DLNUMFET)] %>%
.[,`:=` ( dlv = fifelse( DLNUMFET > 1, "Multiple", "Singleton"))] %>%
# build 2x2 table
janitor::tabyl(dlv, BrthYear) %>%
# add column totals
janitor::adorn_totals(c("row")) %>%
dplyr::mutate_if(is.numeric, scales::comma_format())
tbl <- dta[, .(BrthYear,
DLNUMFET)] %>%
.[,`:=` ( dlv = fifelse( DLNUMFET > 1, "Multiple", "Singleton"))] %>%
# build 2x2 table
janitor::tabyl(dlv, BrthYear) %>%
# add column totals
janitor::adorn_totals(c("row")) %>%
#dplyr::mutate_if(is.numeric, scales::comma_format()) %>%
# formating the percentage value
#janitor::adorn_percentages("col") %>%
#janitor::adorn_pct_formatting(digits = 0) %>%
#janitor::adorn_ns(ns = frmt_ns) %>%
# add titles
janitor::adorn_title(row_name = "",
col_name = "")
knitr::kable(tbl) %>%
# add an hline before the total
kableExtra::row_spec(nrow(tbl) - 2, hline_after = TRUE) %>%  kableExtra::row_spec(nrow(tbl), bold = TRUE) %>%
kableExtra::row_spec(0, bold = TRUE) %>%
kableExtra::column_spec(1, border_right = TRUE, bold  = TRUE) %>%
kableExtra::kable_styling(font_size = 12)
dta1 <- dta[, .(BrthYear,
DLNUMFET)] %>%
.[, `:=` (count = .N),
by = list(BrthYear)] %>%
.[, .(BrthYear,
count)] %>%
unique() %>%
arrange(BrthYear)
plot <- ggplot(data = dta1
aes(x = BrthYear,
plot <- ggplot(data = dta1,
aes(x = BrthYear,
y = count,
group = 1,
text = paste("<br>Year:", BrthYear,
"<br># births:", scales::comma(count, accuracy = 1)
)
)
) +
geom_point(color = "#757575",
show.legend = FALSE) +
geom_line(color = "#757575",
show.legend = FALSE,
alpha = 0.65) +
# scale_x_date(date_breaks = "2 years",
#              date_labels = "%Y") +
scale_x_continuous(#trans = 'log2',
breaks = pretty) +
scale_y_continuous(#trans = 'log2',
breaks = pretty,
labels = scales::comma_format(accuracy = 1),
limits = c(0, NA)) +
labs(y = 'Number of births', x = '') +
theme_minimal()
plotly::ggplotly(plot, tooltip = c("text")) %>%
plotly::style(hoverlabel = list(
bgcolor  = "black",
bordercolor = "transparent",
font = list(
color = "white",
size = 14,
face = "bold"
)
)) %>%
plotly::layout(legend = list(orientation = "h", y = -0.25, x = 0.35),
font = list(face = "bold", size = 10))
tbl <- dta[, .(BrthYear,
BTOUTCOM,
BTSEX)] %>%
.[,`:=` ( dlv = fifelse( !BTOUTCOM %in% "FTD" &
BTSEX %in% "M", "Male live births",
fifelse(!BTOUTCOM %in% "FTD" &
BTSEX %in% "F", "Female live births",
fifelse(BTOUTCOM %in% "FTD" &
BTSEX %in% "M", "Male stillbirths","Female stillbirths"))),
dlv1 = fifelse(!BTOUTCOM %in% "FTD", "Total live births", "Total stillbirths"))] %>%
# remove ambiguous phenotype sex
.[!tolower(BTSEX) %in% "a"] %>%
.[, `:=` (BTSEX = factor(BTSEX,
levels = c("F","M"),
labels = c("Female","Male")))]
tbl.f <- tbl[tolower(BTSEX) %in% "female",] %>%
janitor::tabyl(dlv, BrthYear) %>%
# add column totals
janitor::adorn_totals(c("row"), name = "Female births")
tbl.m <- tbl[tolower(BTSEX) %in% "male",] %>%
janitor::tabyl(dlv, BrthYear) %>%
# add column totals
janitor::adorn_totals(c("row"), name = "Male births")
tbl.t <- tbl %>%
janitor::tabyl(dlv1, BrthYear) %>%
# add column totals
janitor::adorn_totals(c("row"), name = "Total births") %>%
setnames(old = "dlv1", new = "dlv")
tbl <- rbind(tbl.f, tbl.m, tbl.t) %>%
# add titles
janitor::adorn_title(row_name = "",
col_name = "")
knitr::kable(tbl,
format = "html",
booktabs = TRUE) %>%
# add an hline before the total
kableExtra::row_spec(nrow(tbl) - 1, hline_after = TRUE) %>%  kableExtra::row_spec(nrow(tbl), bold = TRUE) %>%
kableExtra::row_spec(0, bold = TRUE) %>%
kableExtra::row_spec(nrow(tbl) - 6, bold = TRUE) %>%
kableExtra::row_spec(nrow(tbl) - 3, bold = TRUE) %>%
kableExtra::column_spec(1, border_right = TRUE, bold  = TRUE) %>%
kableExtra::kable_styling(font_size = 12) %>%
kableExtra::add_footnote(label = c("Sex could not be determined in some infants and these infants are not included in the male or female categories.",
"Note: Stillbirth refers to the complete expulsion or extraction from its mother after at least 20 weeks pregnancy, or after attaining a
weight of 500 g or more, of a fetus in whom, after such expulsion or extraction, there is no breathing, beating of the heart, pulsation
of the umbilical cord, or unmistakable movement of voluntary muscle."))
dta1 <- dta[, .(BrthYear,
DLNUMFET,
# MZ311,
# MZ312,
# MZ313,
MZ37001,
MZ37101,
MZ37201,
MZ37301,
MZ37501,
MZ37611,
MZ37911
)] %>%
.[, `:=` (art  = fifelse(
MZ37001 >= 1 |
MZ37101 >= 1 |
MZ37201 >= 1 |
MZ37301 >= 1 |
MZ37501 >= 1 |
MZ37611 >= 1 |
MZ37911 >= 1 , 1, 0),
dlv = fifelse( DLNUMFET >= 1, 1, 0)),
by = list(BrthYear)] %>%
.[, .(BrthYear,
dlv,
# MZ311,
# MZ312,
# MZ313,
art)] %>%
arrange(BrthYear) %>%
.[, `:=` (dlv = sum(dlv, na.rm = TRUE),
art = sum(art, na.rm = TRUE)),
by = list(BrthYear)] %>%
.[, `:=` (prop = art/dlv)] %>%
unique()
plot <- ggplot(data = dta1,
aes(x = BrthYear,
y = prop,
group = 1,
text = paste("<br>Year:", BrthYear,
"<br># births:", scales::comma(dlv, accuracy = 1),
"<br># ART births:", scales::comma(art, accuracy = 1),
"<br>ART %:", scales::percent(prop, accuracy = 0.1)
)
)
) +
geom_point(color = "#757575",
show.legend = FALSE) +
geom_line(color = "#757575",
show.legend = FALSE,
alpha = 0.65) +
# scale_x_date(date_breaks = "2 years",
#              date_labels = "%Y") +
scale_x_continuous(#trans = 'log2',
breaks = pretty) +
scale_y_continuous(#trans = 'log2',
breaks = pretty,
labels = scales::percent_format(accuracy = 0.1),
limits = c(0, NA)) +
labs(y = 'Proportion of deliveries', x = '') +
theme_minimal()
plotly::ggplotly(plot, tooltip = c("text")) %>%
plotly::style(hoverlabel = list(
bgcolor  = "black",
bordercolor = "transparent",
font = list(
color = "white",
size = 14,
face = "bold"
)
)) %>%
plotly::layout(legend = list(orientation = "h", y = -0.25, x = 0.35),
font = list(face = "bold", size = 10))
tbl <- dta[, .(BrthYear,
BTOUTCOM,
BTSEX)] %>%
.[,`:=` ( dlv = fifelse(!BTOUTCOM %in% "FTD" &
BTSEX %in% "M", "Male live births",
fifelse(!BTOUTCOM %in% "FTD" &
BTSEX %in% "F", "Female live births",
fifelse(BTOUTCOM %in% "FTD" &
BTSEX %in% "M", "Male stillbirths","Female stillbirths"))),
dlv1 = fifelse(!BTOUTCOM %in% "FTD", "Total live births", "Total stillbirths"))] %>%
# remove ambiguous phenotype sex
.[!tolower(BTSEX) %in% "a",] %>%
.[, `:=` (BTSEX = factor(BTSEX,
levels = c("F","M"),
labels = c("Female","Male")))]
View(tbl)
tbl <- dta[, .(BrthYear,
BTOUTCOM,
BTSEX)] %>%
.[,`:=` ( dlv = fifelse(!BTOUTCOM %in% "FTD" &
BTSEX %in% "M", "Male live births",
fifelse(!BTOUTCOM %in% "FTD" &
BTSEX %in% "F", "Female live births",
fifelse(BTOUTCOM %in% "FTD" &
BTSEX %in% "M", "Male stillbirths","Female stillbirths"))),
dlv1 = fifelse(!BTOUTCOM %in% "FTD", "Total live births", "Total stillbirths"))] %>%
# remove ambiguous phenotype sex
.[!tolower(BTSEX) %in% "a",]
View(tbl)
rm(list=ls())
